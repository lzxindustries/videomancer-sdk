{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lzxindustries.com/schemas/vmprog_program_config_v1_0.json",
  "title": "Videomancer Program Configuration",
  "description": "Schema for vmprog_program_config_v1_0 structure defined in vmprog_format.hpp",
  "type": "object",
  "required": ["program"],
  "properties": {
    "program": {
      "type": "object",
      "description": "Main program metadata and configuration",
      "required": [
        "program_id",
        "program_version_major",
        "program_version_minor",
        "program_version_patch",
        "abi_min_major",
        "abi_min_minor",
        "abi_max_major",
        "abi_max_minor",
        "hw_mask",
        "program_name",
        "author",
        "license",
        "category",
        "description",
        "parameter_count"
      ],
      "properties": {
        "program_id": {
          "type": "string",
          "description": "Unique program identifier (e.g., reverse DNS notation)",
          "maxLength": 63,
          "minLength": 1,
          "pattern": "^[a-zA-Z0-9._-]+$",
          "examples": [
            "com.lzxindustries.example.waveform_generator",
            "org.example.video.chromakey"
          ]
        },
        "program_version_major": {
          "type": "integer",
          "description": "Program major version number",
          "minimum": 0,
          "maximum": 65535
        },
        "program_version_minor": {
          "type": "integer",
          "description": "Program minor version number",
          "minimum": 0,
          "maximum": 65535
        },
        "program_version_patch": {
          "type": "integer",
          "description": "Program patch version number",
          "minimum": 0,
          "maximum": 65535
        },
        "abi_min_major": {
          "type": "integer",
          "description": "Minimum ABI major version (inclusive)",
          "minimum": 1,
          "maximum": 65535
        },
        "abi_min_minor": {
          "type": "integer",
          "description": "Minimum ABI minor version (inclusive)",
          "minimum": 0,
          "maximum": 65535
        },
        "abi_max_major": {
          "type": "integer",
          "description": "Maximum ABI major version (exclusive)",
          "minimum": 1,
          "maximum": 65535
        },
        "abi_max_minor": {
          "type": "integer",
          "description": "Maximum ABI minor version (exclusive)",
          "minimum": 0,
          "maximum": 65535
        },
        "hw_mask": {
          "description": "Hardware compatibility flags bitmask",
          "oneOf": [
            {
              "type": "integer",
              "minimum": 1,
              "maximum": 4294967295,
              "description": "Decimal hardware mask value"
            },
            {
              "type": "string",
              "pattern": "^0x[0-9A-Fa-f]{1,8}$",
              "description": "Hexadecimal hardware mask (e.g., 0x00000003)"
            }
          ],
          "examples": [
            1,
            2,
            3,
            "0x00000001",
            "0x00000003"
          ]
        },
        "program_name": {
          "type": "string",
          "description": "Human-readable program name for display",
          "maxLength": 31,
          "minLength": 1,
          "examples": [
            "Waveform Generator",
            "Video Colorizer"
          ]
        },
        "author": {
          "type": "string",
          "description": "Program author or organization name",
          "maxLength": 63,
          "minLength": 1,
          "examples": [
            "LZX Industries LLC",
            "Jane Doe"
          ]
        },
        "license": {
          "type": "string",
          "description": "License identifier (SPDX format recommended)",
          "maxLength": 31,
          "minLength": 1,
          "examples": [
            "GPL-3.0",
            "MIT",
            "Apache-2.0",
            "Proprietary"
          ]
        },
        "category": {
          "type": "string",
          "description": "Program category for organization",
          "maxLength": 31,
          "minLength": 0,
          "examples": [
            "Signal Generation",
            "Video Processing",
            "Effects",
            "Utilities"
          ]
        },
        "description": {
          "type": "string",
          "description": "Detailed program description",
          "maxLength": 127,
          "minLength": 0,
          "examples": [
            "A versatile waveform generator with multiple controls for frequency, amplitude, and shape modulation."
          ]
        },
        "parameter_count": {
          "type": "integer",
          "description": "Number of active parameters (0-12)",
          "minimum": 0,
          "maximum": 12
        }
      },
      "additionalProperties": false
    },
    "parameter": {
      "type": "array",
      "description": "Array of parameter configurations (maximum 12)",
      "minItems": 0,
      "maxItems": 12,
      "items": {
        "type": "object",
        "description": "Individual parameter configuration (vmprog_parameter_config_v1_0)",
        "required": [
          "parameter_id",
          "control_mode",
          "min_value",
          "max_value",
          "initial_value",
          "display_min_value",
          "display_max_value",
          "display_float_digits",
          "value_label_count",
          "name_label",
          "suffix_label",
          "value_labels"
        ],
        "properties": {
          "parameter_id": {
            "type": "integer",
            "description": "Physical hardware control mapping",
            "enum": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10,
              11,
              12
            ],
            "enumDescriptions": {
              "0": "none - No parameter assigned",
              "1": "rotary_potentiometer_1",
              "2": "rotary_potentiometer_2",
              "3": "rotary_potentiometer_3",
              "4": "rotary_potentiometer_4",
              "5": "rotary_potentiometer_5",
              "6": "rotary_potentiometer_6",
              "7": "toggle_switch_7",
              "8": "toggle_switch_8",
              "9": "toggle_switch_9",
              "10": "toggle_switch_10",
              "11": "toggle_switch_11",
              "12": "linear_potentiometer_12"
            }
          },
          "control_mode": {
            "type": "integer",
            "description": "How parameter values are interpreted and displayed",
            "enum": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10,
              11,
              12,
              13,
              14,
              15,
              16,
              17,
              18,
              19,
              20,
              21,
              22,
              23,
              24,
              25,
              26,
              27,
              28,
              29,
              30,
              31,
              32,
              33,
              34,
              35
            ],
            "enumDescriptions": {
              "0": "linear - Linear 1:1 mapping",
              "1": "linear_half - Linear × 0.5",
              "2": "linear_quarter - Linear × 0.25",
              "3": "linear_double - Linear × 2.0",
              "4": "boolean - On/off switch",
              "5": "steps_4 - 4 discrete steps",
              "6": "steps_8 - 8 discrete steps",
              "7": "steps_16 - 16 discrete steps",
              "8": "steps_32 - 32 discrete steps",
              "9": "steps_64 - 64 discrete steps",
              "10": "steps_128 - 128 discrete steps",
              "11": "steps_256 - 256 discrete steps",
              "12": "polar_degs_90 - 0-90 degrees",
              "13": "polar_degs_180 - 0-180 degrees",
              "14": "polar_degs_360 - 0-360 degrees",
              "15": "polar_degs_720 - 0-720 degrees",
              "16": "polar_degs_1440 - 0-1440 degrees",
              "17": "polar_degs_2880 - 0-2880 degrees",
              "18": "quad_in - Quadratic ease-in",
              "19": "quad_out - Quadratic ease-out",
              "20": "quad_in_out - Quadratic ease-in-out",
              "21": "sine_in - Sinusoidal ease-in",
              "22": "sine_out - Sinusoidal ease-out",
              "23": "sine_in_out - Sinusoidal ease-in-out",
              "24": "circ_in - Circular ease-in",
              "25": "circ_out - Circular ease-out",
              "26": "circ_in_out - Circular ease-in-out",
              "27": "quint_in - Quintic ease-in",
              "28": "quint_out - Quintic ease-out",
              "29": "quint_in_out - Quintic ease-in-out",
              "30": "quart_in - Quartic ease-in",
              "31": "quart_out - Quartic ease-out",
              "32": "quart_in_out - Quartic ease-in-out",
              "33": "expo_in - Exponential ease-in",
              "34": "expo_out - Exponential ease-out",
              "35": "expo_in_out - Exponential ease-in-out"
            }
          },
          "min_value": {
            "type": "integer",
            "description": "Minimum raw hardware value",
            "minimum": 0,
            "maximum": 65535
          },
          "max_value": {
            "type": "integer",
            "description": "Maximum raw hardware value",
            "minimum": 0,
            "maximum": 65535
          },
          "initial_value": {
            "type": "integer",
            "description": "Initial/default value (must be between min_value and max_value)",
            "minimum": 0,
            "maximum": 65535
          },
          "display_min_value": {
            "type": "integer",
            "description": "Minimum value for display purposes",
            "minimum": 0,
            "maximum": 65535
          },
          "display_max_value": {
            "type": "integer",
            "description": "Maximum value for display purposes",
            "minimum": 0,
            "maximum": 65535
          },
          "display_float_digits": {
            "type": "integer",
            "description": "Number of decimal places to show when displaying value",
            "minimum": 0,
            "maximum": 255
          },
          "value_label_count": {
            "type": "integer",
            "description": "Number of discrete value labels (0-16)",
            "minimum": 0,
            "maximum": 16
          },
          "name_label": {
            "type": "string",
            "description": "Parameter name displayed to user",
            "maxLength": 31,
            "minLength": 0,
            "examples": [
              "Frequency",
              "Amplitude",
              "Brightness",
              "Contrast"
            ]
          },
          "suffix_label": {
            "type": "string",
            "description": "Unit suffix for display (e.g., Hz, %, °)",
            "maxLength": 3,
            "minLength": 0,
            "examples": [
              "Hz",
              "%",
              "°",
              "dB",
              ""
            ]
          },
          "value_labels": {
            "type": "array",
            "description": "Discrete value labels for stepped parameters (maximum 16)",
            "minItems": 0,
            "maxItems": 16,
            "items": {
              "type": "string",
              "description": "Label for a specific discrete value",
              "maxLength": 31,
              "minLength": 0,
              "examples": [
                "Off",
                "Low",
                "Medium",
                "High",
                "Sine",
                "Triangle",
                "Sawtooth",
                "Square"
              ]
            }
          }
        },
        "additionalProperties": false,
        "allOf": [
          {
            "description": "initial_value must be between min_value and max_value",
            "if": {
              "properties": {
                "min_value": { "type": "integer" },
                "max_value": { "type": "integer" },
                "initial_value": { "type": "integer" }
              },
              "required": ["min_value", "max_value", "initial_value"]
            },
            "then": {
              "properties": {
                "initial_value": {
                  "minimum": { "$data": "1/min_value" },
                  "maximum": { "$data": "1/max_value" }
                }
              }
            }
          },
          {
            "description": "min_value must not exceed max_value",
            "if": {
              "properties": {
                "min_value": { "type": "integer" },
                "max_value": { "type": "integer" }
              },
              "required": ["min_value", "max_value"]
            },
            "then": {
              "properties": {
                "min_value": {
                  "maximum": { "$data": "1/max_value" }
                }
              }
            }
          },
          {
            "description": "display_min_value must not exceed display_max_value",
            "if": {
              "properties": {
                "display_min_value": { "type": "integer" },
                "display_max_value": { "type": "integer" }
              },
              "required": ["display_min_value", "display_max_value"]
            },
            "then": {
              "properties": {
                "display_min_value": {
                  "maximum": { "$data": "1/display_max_value" }
                }
              }
            }
          },
          {
            "description": "value_labels array length must match value_label_count",
            "if": {
              "properties": {
                "value_label_count": { "type": "integer" },
                "value_labels": { "type": "array" }
              },
              "required": ["value_label_count", "value_labels"]
            },
            "then": {
              "properties": {
                "value_labels": {
                  "minItems": { "$data": "1/value_label_count" },
                  "maxItems": { "$data": "1/value_label_count" }
                }
              }
            }
          }
        ]
      }
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "description": "parameter array length must match program.parameter_count",
      "if": {
        "properties": {
          "program": {
            "properties": {
              "parameter_count": { "type": "integer" }
            },
            "required": ["parameter_count"]
          },
          "parameter": { "type": "array" }
        },
        "required": ["program", "parameter"]
      },
      "then": {
        "properties": {
          "parameter": {
            "minItems": { "$data": "1/program/parameter_count" },
            "maxItems": { "$data": "1/program/parameter_count" }
          }
        }
      }
    },
    {
      "description": "abi_min must not exceed abi_max (major.minor comparison)",
      "if": {
        "properties": {
          "program": {
            "properties": {
              "abi_min_major": { "type": "integer" },
              "abi_min_minor": { "type": "integer" },
              "abi_max_major": { "type": "integer" },
              "abi_max_minor": { "type": "integer" }
            },
            "required": ["abi_min_major", "abi_min_minor", "abi_max_major", "abi_max_minor"]
          }
        },
        "required": ["program"]
      },
      "then": {
        "anyOf": [
          {
            "properties": {
              "program": {
                "properties": {
                  "abi_min_major": { "maximum": { "$data": "2/program/abi_max_major" } }
                }
              }
            }
          },
          {
            "properties": {
              "program": {
                "allOf": [
                  {
                    "properties": {
                      "abi_min_major": { "const": { "$data": "2/program/abi_max_major" } }
                    }
                  },
                  {
                    "properties": {
                      "abi_min_minor": { "maximum": { "$data": "2/program/abi_max_minor" } }
                    }
                  }
                ]
              }
            }
          }
        ]
      }
    }
  ],
  "definitions": {
    "hardware_flags": {
      "description": "Hardware compatibility flags",
      "type": "object",
      "properties": {
        "videomancer_core_rev_a": {
          "const": 1,
          "description": "0x00000001 - Videomancer Core Rev A"
        },
        "videomancer_core_rev_b": {
          "const": 2,
          "description": "0x00000002 - Videomancer Core Rev B"
        }
      }
    },
    "parameter_ids": {
      "description": "Parameter ID to hardware control mapping",
      "type": "object",
      "properties": {
        "none": { "const": 0 },
        "rotary_potentiometer_1": { "const": 1 },
        "rotary_potentiometer_2": { "const": 2 },
        "rotary_potentiometer_3": { "const": 3 },
        "rotary_potentiometer_4": { "const": 4 },
        "rotary_potentiometer_5": { "const": 5 },
        "rotary_potentiometer_6": { "const": 6 },
        "toggle_switch_7": { "const": 7 },
        "toggle_switch_8": { "const": 8 },
        "toggle_switch_9": { "const": 9 },
        "toggle_switch_10": { "const": 10 },
        "toggle_switch_11": { "const": 11 },
        "linear_potentiometer_12": { "const": 12 }
      }
    },
    "control_modes": {
      "description": "Parameter control mode enumerations",
      "type": "object",
      "properties": {
        "linear": { "const": 0 },
        "linear_half": { "const": 1 },
        "linear_quarter": { "const": 2 },
        "linear_double": { "const": 3 },
        "boolean": { "const": 4 },
        "steps_4": { "const": 5 },
        "steps_8": { "const": 6 },
        "steps_16": { "const": 7 },
        "steps_32": { "const": 8 },
        "steps_64": { "const": 9 },
        "steps_128": { "const": 10 },
        "steps_256": { "const": 11 },
        "polar_degs_90": { "const": 12 },
        "polar_degs_180": { "const": 13 },
        "polar_degs_360": { "const": 14 },
        "polar_degs_720": { "const": 15 },
        "polar_degs_1440": { "const": 16 },
        "polar_degs_2880": { "const": 17 },
        "quad_in": { "const": 18 },
        "quad_out": { "const": 19 },
        "quad_in_out": { "const": 20 },
        "sine_in": { "const": 21 },
        "sine_out": { "const": 22 },
        "sine_in_out": { "const": 23 },
        "circ_in": { "const": 24 },
        "circ_out": { "const": 25 },
        "circ_in_out": { "const": 26 },
        "quint_in": { "const": 27 },
        "quint_out": { "const": 28 },
        "quint_in_out": { "const": 29 },
        "quart_in": { "const": 30 },
        "quart_out": { "const": 31 },
        "quart_in_out": { "const": 32 },
        "expo_in": { "const": 33 },
        "expo_out": { "const": 34 },
        "expo_in_out": { "const": 35 }
      }
    }
  },
  "examples": [
    {
      "program": {
        "program_id": "com.lzxindustries.example.waveform_generator",
        "program_version_major": 1,
        "program_version_minor": 2,
        "program_version_patch": 3,
        "abi_min_major": 1,
        "abi_min_minor": 0,
        "abi_max_major": 2,
        "abi_max_minor": 0,
        "hw_mask": "0x00000003",
        "program_name": "Waveform Generator",
        "author": "LZX Industries LLC",
        "license": "GPL-3.0",
        "category": "Signal Generation",
        "description": "A versatile waveform generator with multiple controls for frequency, amplitude, and shape modulation.",
        "parameter_count": 2
      },
      "parameter": [
        {
          "parameter_id": 1,
          "control_mode": 0,
          "min_value": 0,
          "max_value": 4095,
          "initial_value": 2048,
          "display_min_value": 0,
          "display_max_value": 1000,
          "display_float_digits": 1,
          "value_label_count": 0,
          "name_label": "Frequency",
          "suffix_label": "Hz",
          "value_labels": []
        },
        {
          "parameter_id": 2,
          "control_mode": 0,
          "min_value": 0,
          "max_value": 4095,
          "initial_value": 4095,
          "display_min_value": 0,
          "display_max_value": 100,
          "display_float_digits": 0,
          "value_label_count": 0,
          "name_label": "Amplitude",
          "suffix_label": "%",
          "value_labels": []
        }
      ]
    }
  ]
}
