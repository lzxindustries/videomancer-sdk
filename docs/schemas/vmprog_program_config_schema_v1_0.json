{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lzxindustries.com/schemas/vmprog_program_config_v1_0.json",
  "title": "Videomancer Program Configuration",
  "description": "Schema for vmprog_program_config_v1_0 structure defined in vmprog_format.hpp",
  "type": "object",
  "required": [
    "program"
  ],
  "properties": {
    "program": {
      "type": "object",
      "description": "Main program metadata and configuration",
      "required": [
        "program_id",
        "program_name"
      ],
      "properties": {
        "program_id": {
          "type": "string",
          "description": "Unique program identifier (e.g., reverse DNS notation)",
          "maxLength": 63,
          "minLength": 1,
          "pattern": "^[a-zA-Z0-9._-]+$",
          "examples": [
            "com.lzxindustries.example.waveform_generator",
            "org.example.video.chromakey"
          ]
        },
        "program_version_major": {
          "type": "integer",
          "description": "DEPRECATED: Use program_version string field instead. Program major version number",
          "minimum": 0,
          "maximum": 65535
        },
        "program_version_minor": {
          "type": "integer",
          "description": "DEPRECATED: Use program_version string field instead. Program minor version number",
          "minimum": 0,
          "maximum": 65535
        },
        "program_version_patch": {
          "type": "integer",
          "description": "DEPRECATED: Use program_version string field instead. Program patch version number",
          "minimum": 0,
          "maximum": 65535
        },
        "abi_min_major": {
          "type": "integer",
          "description": "DEPRECATED: Use abi_version string field instead. Minimum ABI major version (inclusive)",
          "minimum": 1,
          "maximum": 65535
        },
        "abi_min_minor": {
          "type": "integer",
          "description": "DEPRECATED: Use abi_version string field instead. Minimum ABI minor version (inclusive)",
          "minimum": 0,
          "maximum": 65535
        },
        "abi_max_major": {
          "type": "integer",
          "description": "DEPRECATED: Use abi_version string field instead. Maximum ABI major version (exclusive)",
          "minimum": 1,
          "maximum": 65535
        },
        "abi_max_minor": {
          "type": "integer",
          "description": "DEPRECATED: Use abi_version string field instead. Maximum ABI minor version (exclusive)",
          "minimum": 0,
          "maximum": 65535
        },
        "program_name": {
          "type": "string",
          "description": "Human-readable program name for display",
          "maxLength": 31,
          "minLength": 1,
          "examples": [
            "Waveform Generator",
            "Video Colorizer"
          ]
        },
        "author": {
          "type": "string",
          "description": "Program author or organization name. Optional: defaults to empty string if not specified.",
          "maxLength": 63,
          "minLength": 0,
          "examples": [
            "LZX Industries LLC",
            "Jane Doe"
          ]
        },
        "license": {
          "type": "string",
          "description": "License identifier (SPDX format recommended). Optional: defaults to empty string if not specified.",
          "maxLength": 31,
          "minLength": 0,
          "examples": [
            "GPL-3.0",
            "MIT",
            "Apache-2.0",
            "Proprietary"
          ]
        },
        "category": {
          "type": "string",
          "description": "Program category for organization. Optional: defaults to empty string if not specified.",
          "maxLength": 31,
          "minLength": 0,
          "examples": [
            "Signal Generation",
            "Video Processing",
            "Effects",
            "Utilities"
          ]
        },
        "description": {
          "type": "string",
          "description": "Detailed program description. Optional: defaults to empty string if not specified.",
          "maxLength": 127,
          "minLength": 0,
          "examples": [
            "A versatile waveform generator with multiple controls for frequency, amplitude, and shape modulation."
          ]
        },
        "url": {
          "type": "string",
          "description": "Project or documentation URL. Optional: defaults to empty string if not specified.",
          "maxLength": 127,
          "minLength": 0,
          "pattern": "^(https?://|).*$",
          "examples": [
            "https://lzxindustries.com",
            "https://github.com/user/project",
            ""
          ]
        },
        "parameter_count": {
          "type": "integer",
          "description": "Number of active parameters (0-12)",
          "minimum": 0,
          "maximum": 12
        },
        "program_version": {
          "type": "string",
          "description": "Program version in SemVer format (e.g., '1.2.3')",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)$",
          "examples": [
            "1.0.0",
            "0.1.0",
            "2.3.4"
          ]
        },
        "abi_version": {
          "type": "string",
          "description": "ABI version compatibility range (e.g., '>=1.0,<2.0' means 1.0 <= version < 2.0)",
          "pattern": "^>=?(0|[1-9]\\d*)\\.(0|[1-9]\\d*),<(0|[1-9]\\d*)\\.(0|[1-9]\\d*)$",
          "examples": [
            ">=1.0,<2.0",
            ">=1.5,<2.0",
            ">=2.0,<3.0"
          ]
        },
        "hardware_compatibility": {
          "type": "array",
          "description": "List of compatible hardware platforms",
          "items": {
            "type": "string",
            "enum": [
              "rev_a",
              "rev_b"
            ]
          },
          "minItems": 1,
          "uniqueItems": true,
          "examples": [
            ["rev_b"],
            ["rev_a", "rev_b"]
          ]
        },
        "core": {
          "type": "string",
          "description": "Core architecture identifier",
          "enum": [
            "yuv444_30b",
            "yuv422_20b"
          ],
          "examples": [
            "yuv444_30b",
            "yuv422_20b"
          ]
        }
      },
      "additionalProperties": false,
      "oneOf": [
        {
          "description": "New format: use program_version and abi_version strings",
          "required": [
            "program_version",
            "abi_version"
          ]
        },
        {
          "description": "Legacy format: use individual numeric version fields",
          "required": [
            "program_version_major",
            "program_version_minor",
            "program_version_patch",
            "abi_min_major",
            "abi_min_minor",
            "abi_max_major",
            "abi_max_minor"
          ]
        }
      ]
    },
    "parameter": {
      "type": "array",
      "description": "Array of parameter configurations (maximum 12)",
      "minItems": 0,
      "maxItems": 12,
      "items": {
        "type": "object",
        "description": "Individual parameter configuration (vmprog_parameter_config_v1_0)",
        "required": [
          "parameter_id",
          "name_label"
        ],
        "properties": {
          "parameter_id": {
            "type": "string",
            "description": "Physical hardware control mapping",
            "enum": [
              "No parameter assigned",
              "rotary_potentiometer_1",
              "rotary_potentiometer_2",
              "rotary_potentiometer_3",
              "rotary_potentiometer_4",
              "rotary_potentiometer_5",
              "rotary_potentiometer_6",
              "toggle_switch_7",
              "toggle_switch_8",
              "toggle_switch_9",
              "toggle_switch_10",
              "toggle_switch_11",
              "linear_potentiometer_12"
            ],
            "examples": [
              "rotary_potentiometer_1",
              "linear_potentiometer_12",
              "toggle_switch_7"
            ]
          },
          "control_mode": {
            "type": "string",
            "description": "How parameter values are interpreted and displayed",
            "enum": [
              "linear",
              "linear_half",
              "linear_quarter",
              "linear_double",
              "boolean",
              "steps_4",
              "steps_8",
              "steps_16",
              "steps_32",
              "steps_64",
              "steps_128",
              "steps_256",
              "polar_degs_90",
              "polar_degs_180",
              "polar_degs_360",
              "polar_degs_720",
              "polar_degs_1440",
              "polar_degs_2880",
              "quad_in",
              "quad_out",
              "quad_in_out",
              "sine_in",
              "sine_out",
              "sine_in_out",
              "circ_in",
              "circ_out",
              "circ_in_out",
              "quint_in",
              "quint_out",
              "quint_in_out",
              "quart_in",
              "quart_out",
              "quart_in_out",
              "expo_in",
              "expo_out",
              "expo_in_out"
            ],
            "examples": [
              "linear",
              "steps_4",
              "boolean",
              "quad_in"
            ]
          },
          "min_value": {
            "type": "integer",
            "description": "Minimum raw hardware value. Optional: defaults to 0 if not specified.",
            "minimum": 0,
            "maximum": 1023
          },
          "max_value": {
            "type": "integer",
            "description": "Maximum raw hardware value. Optional: defaults to 1023 if not specified.",
            "minimum": 0,
            "maximum": 1023
          },
          "initial_value": {
            "type": "integer",
            "description": "Initial/default value (must be between min_value and max_value). Optional: defaults to 512 if not specified.",
            "minimum": 0,
            "maximum": 1023
          },
          "display_min_value": {
            "type": "integer",
            "description": "Minimum value for display purposes (signed). Optional: defaults to min_value if not specified.",
            "minimum": -32768,
            "maximum": 32767
          },
          "display_max_value": {
            "type": "integer",
            "description": "Maximum value for display purposes (signed). Optional: defaults to max_value if not specified.",
            "minimum": -32768,
            "maximum": 32767
          },
          "display_float_digits": {
            "type": "integer",
            "description": "Number of decimal places to show when displaying value. Optional: defaults to 0 if not specified.",
            "minimum": 0,
            "maximum": 255
          },
          "value_label_count": {
            "type": "integer",
            "description": "DEPRECATED: Auto-calculated from value_labels array length. Do not include in TOML files.",
            "minimum": 0,
            "maximum": 16
          },
          "name_label": {
            "type": "string",
            "description": "Parameter name displayed to user",
            "maxLength": 31,
            "minLength": 0,
            "examples": [
              "Frequency",
              "Amplitude",
              "Brightness",
              "Contrast"
            ]
          },
          "suffix_label": {
            "type": "string",
            "description": "Unit suffix for display (e.g., Hz, %, °)",
            "maxLength": 3,
            "minLength": 0,
            "examples": [
              "Hz",
              "%",
              "°",
              "dB",
              ""
            ]
          },
          "value_labels": {
            "type": "array",
            "description": "Discrete value labels for stepped parameters (maximum 16)",
            "minItems": 2,
            "maxItems": 16,
            "items": {
              "type": "string",
              "description": "Label for a specific discrete value",
              "maxLength": 31,
              "minLength": 0,
              "examples": [
                "Off",
                "Low",
                "Medium",
                "High",
                "Sine",
                "Triangle",
                "Sawtooth",
                "Square"
              ]
            }
          },
          "initial_value_label": {
            "type": "string",
            "description": "Label identifying the initial value when using value_labels. Must match one of the strings in value_labels array.",
            "maxLength": 31,
            "minLength": 0
          }
        },
        "additionalProperties": false,
        "allOf": [
          {
            "description": "min_value must be less than max_value",
            "if": {
              "required": [
                "min_value",
                "max_value"
              ]
            },
            "then": {
              "properties": {
                "min_value": {
                  "type": "integer",
                  "exclusiveMaximum": {
                    "$data": "1/max_value"
                  }
                }
              }
            }
          },
          {
            "description": "initial_value must be between min_value and max_value",
            "if": {
              "required": [
                "min_value",
                "max_value",
                "initial_value"
              ]
            },
            "then": {
              "properties": {
                "initial_value": {
                  "minimum": {
                    "$data": "1/min_value"
                  },
                  "maximum": {
                    "$data": "1/max_value"
                  }
                }
              }
            }
          },
          {
            "description": "When value_labels is defined, numeric value fields and control_mode must not be defined",
            "if": {
              "required": [
                "value_labels"
              ]
            },
            "then": {
              "not": {
                "anyOf": [
                  {
                    "required": [
                      "min_value"
                    ]
                  },
                  {
                    "required": [
                      "max_value"
                    ]
                  },
                  {
                    "required": [
                      "initial_value"
                    ]
                  },
                  {
                    "required": [
                      "display_min_value"
                    ]
                  },
                  {
                    "required": [
                      "display_max_value"
                    ]
                  },
                  {
                    "required": [
                      "suffix_label"
                    ]
                  },
                  {
                    "required": [
                      "display_float_digits"
                    ]
                  },
                  {
                    "required": [
                      "control_mode"
                    ]
                  }
                ]
              }
            }
          },
          {
            "description": "When numeric mode is used (no value_labels), control_mode is required",
            "if": {
              "not": {
                "required": [
                  "value_labels"
                ]
              }
            },
            "then": {
              "required": [
                "control_mode"
              ]
            }
          },
          {
            "description": "When any numeric value field is defined, value_labels must not be defined",
            "if": {
              "anyOf": [
                {
                  "required": [
                    "min_value"
                  ]
                },
                {
                  "required": [
                    "max_value"
                  ]
                },
                {
                  "required": [
                    "initial_value"
                  ]
                },
                {
                  "required": [
                    "display_min_value"
                  ]
                },
                {
                  "required": [
                    "display_max_value"
                  ]
                },
                {
                  "required": [
                    "suffix_label"
                  ]
                },
                {
                  "required": [
                    "display_float_digits"
                  ]
                }
              ]
            },
            "then": {
              "not": {
                "required": [
                  "value_labels"
                ]
              }
            }
          },
          {
            "description": "initial_value_label can only be used with value_labels",
            "if": {
              "required": [
                "initial_value_label"
              ]
            },
            "then": {
              "required": [
                "value_labels"
              ]
            }
          },
          {
            "description": "initial_value_label must match one of the value_labels",
            "if": {
              "required": [
                "initial_value_label",
                "value_labels"
              ]
            },
            "then": {
              "properties": {
                "initial_value_label": {
                  "enum": {
                    "$data": "1/value_labels"
                  }
                }
              }
            }
          }
        ]
      }
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "description": "abi_min must not exceed abi_max (major.minor comparison)",
      "if": {
        "properties": {
          "program": {
            "properties": {
              "abi_min_major": {
                "type": "integer"
              },
              "abi_min_minor": {
                "type": "integer"
              },
              "abi_max_major": {
                "type": "integer"
              },
              "abi_max_minor": {
                "type": "integer"
              }
            },
            "required": [
              "abi_min_major",
              "abi_min_minor",
              "abi_max_major",
              "abi_max_minor"
            ]
          }
        },
        "required": [
          "program"
        ]
      },
      "then": {
        "anyOf": [
          {
            "properties": {
              "program": {
                "properties": {
                  "abi_min_major": {
                    "maximum": {
                      "$data": "2/program/abi_max_major"
                    }
                  }
                }
              }
            }
          },
          {
            "properties": {
              "program": {
                "allOf": [
                  {
                    "properties": {
                      "abi_min_major": {
                        "const": {
                          "$data": "2/program/abi_max_major"
                        }
                      }
                    }
                  },
                  {
                    "properties": {
                      "abi_min_minor": {
                        "maximum": {
                          "$data": "2/program/abi_max_minor"
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        ]
      }
    }
  ],
  "definitions": {
    "hardware_flags": {
      "description": "Hardware compatibility flags",
      "type": "object",
      "properties": {
        "rev_a": {
          "const": 1,
          "description": "0x00000001 - Videomancer Core Rev A"
        },
        "rev_b": {
          "const": 2,
          "description": "0x00000002 - Videomancer Core Rev B"
        }
      }
    },
    "parameter_ids": {
      "description": "Parameter ID to hardware control mapping",
      "type": "object",
      "properties": {
        "none": {
          "const": 0
        },
        "rotary_potentiometer_1": {
          "const": 1
        },
        "rotary_potentiometer_2": {
          "const": 2
        },
        "rotary_potentiometer_3": {
          "const": 3
        },
        "rotary_potentiometer_4": {
          "const": 4
        },
        "rotary_potentiometer_5": {
          "const": 5
        },
        "rotary_potentiometer_6": {
          "const": 6
        },
        "toggle_switch_7": {
          "const": 7
        },
        "toggle_switch_8": {
          "const": 8
        },
        "toggle_switch_9": {
          "const": 9
        },
        "toggle_switch_10": {
          "const": 10
        },
        "toggle_switch_11": {
          "const": 11
        },
        "linear_potentiometer_12": {
          "const": 12
        }
      }
    },
    "control_modes": {
      "description": "Parameter control mode enumerations",
      "type": "object",
      "properties": {
        "linear": {
          "const": 0
        },
        "linear_half": {
          "const": 1
        },
        "linear_quarter": {
          "const": 2
        },
        "linear_double": {
          "const": 3
        },
        "boolean": {
          "const": 4
        },
        "steps_4": {
          "const": 5
        },
        "steps_8": {
          "const": 6
        },
        "steps_16": {
          "const": 7
        },
        "steps_32": {
          "const": 8
        },
        "steps_64": {
          "const": 9
        },
        "steps_128": {
          "const": 10
        },
        "steps_256": {
          "const": 11
        },
        "polar_degs_90": {
          "const": 12
        },
        "polar_degs_180": {
          "const": 13
        },
        "polar_degs_360": {
          "const": 14
        },
        "polar_degs_720": {
          "const": 15
        },
        "polar_degs_1440": {
          "const": 16
        },
        "polar_degs_2880": {
          "const": 17
        },
        "quad_in": {
          "const": 18
        },
        "quad_out": {
          "const": 19
        },
        "quad_in_out": {
          "const": 20
        },
        "sine_in": {
          "const": 21
        },
        "sine_out": {
          "const": 22
        },
        "sine_in_out": {
          "const": 23
        },
        "circ_in": {
          "const": 24
        },
        "circ_out": {
          "const": 25
        },
        "circ_in_out": {
          "const": 26
        },
        "quint_in": {
          "const": 27
        },
        "quint_out": {
          "const": 28
        },
        "quint_in_out": {
          "const": 29
        },
        "quart_in": {
          "const": 30
        },
        "quart_out": {
          "const": 31
        },
        "quart_in_out": {
          "const": 32
        },
        "expo_in": {
          "const": 33
        },
        "expo_out": {
          "const": 34
        },
        "expo_in_out": {
          "const": 35
        }
      }
    }
  },
  "examples": [
    {
      "program": {
        "program_id": "com.lzxindustries.example.waveform_generator",
        "hw_mask": "0x00000003",
        "program_name": "Waveform Generator",
        "author": "LZX Industries LLC",
        "license": "GPL-3.0",
        "category": "Signal Generation",
        "description": "A versatile waveform generator with multiple controls for frequency, amplitude, and shape modulation.",
        "program_version": "1.2.3",
        "abi_version": ">=1.0,<2.0"
      },
      "parameter": [
        {
          "parameter_id": "rotary_potentiometer_1",
          "control_mode": 0,
          "min_value": 0,
          "max_value": 4095,
          "initial_value": 2048,
          "display_min_value": 0,
          "display_max_value": 1000,
          "display_float_digits": 1,
          "name_label": "Frequency",
          "suffix_label": "Hz",
          "value_labels": [],
          "parameter": "linear"
        },
        {
          "parameter_id": "rotary_potentiometer_2",
          "control_mode": 0,
          "min_value": 0,
          "max_value": 4095,
          "initial_value": 4095,
          "display_min_value": 0,
          "display_max_value": 100,
          "display_float_digits": 0,
          "name_label": "Amplitude",
          "suffix_label": "%",
          "value_labels": [],
          "parameter": "linear"
        }
      ]
    }
  ]
}
